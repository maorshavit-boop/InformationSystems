<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order Details - FLYTAU</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="order-details-page">

    <header>
        <div class="header-container">
            <div class="header-left">
                <a href="{{ url_for('guest_manage') }}" class="btn-back">‚Üê BACK</a>
            </div>
            <div class="logo-box">
                <img src="{{ url_for('static', filename='logo.png') }}" width="80" alt="FlyTau">
            </div>
        </div>
    </header>

    <main class="main-content container-width">

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container">
              {% for category, message in messages %}
                <div class="flash-message {{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <div class="trips-container">

            <div class="trip-header-info">
                #{{ order.info.order_code }} Ordered on: {{ order.info.order_date }}
            </div>

            <div class="status-container">
                <span class="status-badge">
                    {{ order.info.status }}
                </span>
            </div>

            <div class="tickets-title">Tickets in this order:</div>

            {% for ticket in order.tickets %}
            <div class="trip-details">
                <span class="detail-line">FLIGHT {{ ticket.flight_id }}</span>
                <span class="detail-line">ROUTE {{ ticket.source_airport }} &#8594; {{ ticket.destination_airport }}</span>
                <span class="detail-line">DEPARTURE {{ ticket.departure_date }} {{ ticket.departure_time }}</span>
                <span class="detail-line">SEAT {{ ticket.row_num }}{{ ticket.column_num|map_to_letter }} ({{ ticket.class_type }})</span>
            </div>
            {% endfor %}

            <div class="trip-footer">
                <div class="total-price">
                    Total Paid: ${{ order.info.total_price }}
                </div>

                {% if order.info.status|lower == 'active' %}
                <form action="/guest_manage" method="POST" onsubmit="return confirm('WARNING: Cancelling will refund only 95% of the total price. This cannot be undone. Continue?');">
                    <input type="hidden" name="action" value="cancel">
                    <input type="hidden" name="order_code" value="{{ order.info.order_code }}">
                    <input type="hidden" name="email" value="{{ email }}">
                    <button type="submit" class="btn-cancel-trip">
                        CANCEL ENTIRE BOOKING
                    </button>
                </form>
                {% endif %}
            </div>

        </div>
    </main>
</body>
</html>