<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manager Reports - FLYTAU</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Special overrides for the reports grid layout */
        .reports-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .full-width { grid-column: span 2; }

        /* Stat Box Styling */
        .stat-box {
            font-family: var(--font-mono);
            font-size: 4em;
            font-weight: bold;
            color: var(--neon-green);
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(57, 255, 20, 0.3);
        }

        /* Chart Containers */
        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>

    <header class="header-container">
        <div class="header-left-nav">
            <a href="/" class="nav-link-orange"> ‚Üê BACK TO DASHBOARD </a>
        </div>

        <div class="header-center">
            <span class="welcome-text-large">MANAGERIAL REPORTS</span>
        </div>

        <div class="header-right-logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="FLYTAU" width="100" class="dimmed-logo">
        </div>
    </header>

    <main class="trips-container" style="max-width: 1200px;">

        <div class="reports-grid">

            <div class="neon-card">
                <h3 style="color: var(--neon-orange); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top:0;">
                    1. AVG FLIGHT OCCUPANCY
                </h3>
                <div class="stat-box">{{ data.occupancy[0]['avg_capacity_percentage'] | round(2) }}%</div>
                <p style="text-align:center; color: #888; font-size: 0.9em;">
                    Calculated based on executed flights only.
                </p>
            </div>

            <div class="neon-card">
                <h3 style="color: var(--neon-orange); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top:0;">
                    4. MONTHLY CANCELLATION RATE
                </h3>
                <canvas id="cancelChart"></canvas>
            </div>

            <div class="neon-card full-width">
                <h3 style="color: var(--accent-blue); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top:0;">
                    2. TOTAL REVENUE BY PLANE & CLASS
                </h3>
                <canvas id="revenueChart" height="100"></canvas>
            </div>

            <div class="neon-card full-width">
                <h3 style="color: var(--accent-blue); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top:0;">
                    3. CREW FLIGHT HOURS (SHORT vs LONG)
                </h3>
                <canvas id="crewChart" height="100"></canvas>
            </div>

            <div class="neon-card full-width">
                <h3 style="color: var(--neon-yellow); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top:0;">
                    5. MONTHLY PLANE ACTIVITY SUMMARY
                </h3>
                <div style="overflow-x: auto;">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>Plane ID</th>
                                <th>Month</th>
                                <th>Executed</th>
                                <th>Cancelled</th>
                                <th>Utilization %</th>
                                <th>Dominant Route</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data.plane_activity %}
                            <tr class="trip-row">
                                <td style="font-weight: bold; color: var(--neon-yellow);">{{ row.airplane_id }}</td>
                                <td>{{ row.activity_month }}</td>
                                <td>{{ row.flights_executed }}</td>
                                <td style="color: {{ '#ff4444' if row.flights_cancelled > 0 else '#555' }}; font-weight: bold;">
                                    {{ row.flights_cancelled }}
                                </td>
                                <td>{{ row.utilization_percentage }}%</td>
                                <td style="color: #fff;">{{ row.dominant_route or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <script>
        // 1. Set Global Defaults for Dark Mode Charts
        Chart.defaults.color = '#e0e0e0';      // White text
        Chart.defaults.borderColor = '#333';   // Dark grid lines
        Chart.defaults.font.family = "'Share Tech Mono', monospace";

        const revenueData = {{ data.revenue | tojson }};
        const crewData = {{ data.crew | tojson }};
        const cancelData = {{ data.cancellations | tojson }};

        // Revenue Chart
        new Chart(document.getElementById('revenueChart'), {
            type: 'bar',
            data: {
                labels: revenueData.map(d => d.label),
                datasets: [{
                    label: 'Revenue ($)',
                    data: revenueData.map(d => d.total_revenue),
                    backgroundColor: 'rgba(41, 98, 255, 0.6)', // Neon Blue
                    borderColor: '#2962ff',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            }
        });

        // Crew Chart
        new Chart(document.getElementById('crewChart'), {
            type: 'bar',
            data: {
                labels: crewData.map(d => d.First_Name + ' ' + d.Last_Name + ' (' + d.Role + ')'),
                datasets: [
                    {
                        label: 'Short Flights (<6h)',
                        data: crewData.map(d => d.Short_Flight_Hours),
                        backgroundColor: 'rgba(0, 255, 65, 0.6)', // Neon Green
                        borderColor: '#00ff41',
                        borderWidth: 1
                    },
                    {
                        label: 'Long Flights (>6h)',
                        data: crewData.map(d => d.Long_Flight_Hours),
                        backgroundColor: 'rgba(255, 158, 34, 0.6)', // Neon Orange
                        borderColor: '#ff9e22',
                        borderWidth: 1
                    }
                ]
            },
            options: { scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // Cancellations Chart
        new Chart(document.getElementById('cancelChart'), {
            type: 'line',
            data: {
                labels: cancelData.map(d => d.order_month),
                datasets: [{
                    label: 'Cancellation Rate (%)',
                    data: cancelData.map(d => d.cancellation_rate_percent),
                    borderColor: '#ff4444',
                    backgroundColor: 'rgba(255, 68, 68, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointBackgroundColor: '#ff4444'
                }]
            },
            options: { scales: { y: { beginAtZero: true, max: 100 } } }
        });
    </script>
</body>
</html>